<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<script>
    
    var _tz_list = [] ; //实际可能控股人列表
    var _data = [
        {src:'2',dst:'1',percent:'0.3'},
        {src:'3',dst:'1',percent:'0.2'},
        {src:'5',dst:'1',percent:'0.1'},
        {src:'4',dst:'2',percent:'0.2'},
        {src:'6',dst:'2',percent:'0.1'},
        {src:'7',dst:'3',percent:'0.4'},
        {src:'4',dst:'3',percent:'0.1'},
        {src:'6',dst:'4',percent:'0.1'},
        {src:'5',dst:'4',percent:'0.2'},
        {src:'2',dst:'4',percent:'0.2'},
        {src:'8',dst:'1',percent:'0.2'},
    ] ;
    _data.forEach(item=>{
        item.percent = Number(item.percent) ;
    })
    let dst = '1' ;
    let tz_list = _data ; //所有数据
    let srcArr = [] ;//所有投资的列表
    let dstArr = [] ;//所有被投资的列表
    let result = [] ; // 某一家的控股人结果 
    //求出_tz_list
    for(let i=0 ; i<tz_list.length ;i++){
        srcArr.push(tz_list[i].src) ;
        dstArr.push(tz_list[i].dst) ;
    }
    srcArr = Array.from(new Set(srcArr)) ;
    dstArr = Array.from(new Set(dstArr)) ;
    
    _tz_list = srcArr.filter(item=>{
        return dstArr.indexOf(item) == -1
    })

    result = dijkstra(tz_list,dst) ;
    
    console.log(result) ;

function dijkstra(arr,dst){
    var finalArr = [] ; //存储最终比较的数组
    var tempArr = [] ; //临时存放部分投资人
    var branch = [] ; //存放需要保存的分支
    
    for(let i=0 ; i<arr.length ;i++){
        if(arr[i].dst==dst){
            let single = {} ;
            single.src = arr[i].src ;
            single.percent = arr[i].percent ;
            if(_tz_list.indexOf(arr[i].src)!=-1){
                finalArr.push(single) ;
            }else{
                tempArr.push(single) ;
                branch.push(single) ;
            }
        }
    }
    
    var findMore = function(){

        for(let i=0 ; i<tempArr.length ;i++ ){
            let single = {} ;
            for(let j=0 ; j<arr.length ;j++){
    
                if(tempArr[i].src == dst) break ;
    
                if(tempArr[i].src == arr[j].dst){ //找tempArr父级
    
                    if(_tz_list.indexOf(arr[j].src)!=-1){ //判断在不在可能节点
                        let find_off = false ;
                        for(let m=0 ; m<finalArr.length ;m++){ //判断父节点在不在之前放在finalArr里
                            if(arr[j].src==finalArr[m].src){
                                find_off = true ;
                                finalArr[m].percent = finalArr[m].percent+pBranch(branch,arr[j].dst,arr[j].percent) ;
                            }
                        }
                        if(!find_off){
                            find_off = false ;
                            single.src = arr[j].src ;
                            single.dst = dst ;
                            single.percent = tempArr[i].percent*arr[j].percent ;
                            finalArr.push(single) ;
                        }
    
                    }else{
                        tempArr.splice(i,1) ;
                        tempArr.push(arr[j]) ;
                        branch.push(arr[j]) ;
                        // findMore() ;
                    }
    
                }
            } 
        }

        

    }

    findMore() ;

    return finalArr
}

function pBranch(branch,dst,percent){
    let find_p = false ;
    for(let i=0 ; i<branch.length ;i++){
        if(branch[i].src == dst){
            percent = branch[i].percent*percent ;
            for(let j=0 ; j<branch.length ;j++){
                if(branch[i].dst = branch[j].src){
                    find_p = true ;
                    percent = branch[j].percent
                    pBranch(branch,branch[i].dst,percent) ;
                }
            }
            if(!find_p){
                return percent ;
            }   
        }
    }

}



</script>
<body>
    
</body>
</html>